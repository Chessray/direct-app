<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
        "http://struts.apache.org/dtds/struts-2.0.dtd">
<struts>
    <!--
        This is a configuration file for Struts2 context to be used by TC Direct application.
    -->
    <constant name="struts.objectFactory" value="spring"/>
    <constant name="struts.devMode" value="true"/>
    <constant name="struts.locale" value="en_US"/>
    <constant name="struts.custom.i18n.resources" value="Messages"/>
    <constant name="struts.ui.theme" value="simple"/>
    <constant name="struts.convention.exclude.parentClassLoader" value="true" />
    <constant name="struts.convention.action.fileProtocols" value="jar,vfsfile,vfszip" />
    <constant name="struts.multipart.maxSize" value="10485760" />



    <package name="default" extends="struts-default" namespace="/">
        <result-types>
            <result-type name="json" class="com.topcoder.direct.services.view.ajax.CustomFormatAJAXResult">
            </result-type>
        </result-types>
        <interceptors>
            <interceptor name="preProcessor" class="com.topcoder.direct.services.view.interceptor.ActionPreProcessor"/>
            <interceptor name="projectAccessGuard"
                         class="com.topcoder.direct.services.view.interceptor.ProjectAccessInterceptor"/>
            <interceptor name="contestAccessGuard"
                         class="com.topcoder.direct.services.view.interceptor.ContestAccessInterceptor"/>
            <interceptor name="authnInterceptor"
                         class="authenticationInterceptor"/>
            <interceptor name="loggingInterceptor"
                         class="loggingInterceptor"/>
            <interceptor-stack name="preProcessorStack">
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="preProcessor"/>
            </interceptor-stack>
            <interceptor-stack name="securedPreProcessorStack">
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="authnInterceptor"/>
                <interceptor-ref name="preProcessor"/>
            </interceptor-stack>
            <interceptor-stack name="securedProjectPreProcessorStack">
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="authnInterceptor"/>
                <interceptor-ref name="projectAccessGuard"/>
                <interceptor-ref name="preProcessor"/>
            </interceptor-stack>
            <interceptor-stack name="securedContestPreProcessorStack">
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="authnInterceptor"/>
                <interceptor-ref name="contestAccessGuard"/>
                <interceptor-ref name="preProcessor"/>
            </interceptor-stack>
            <interceptor-stack name="securedContestStack">
                <interceptor-ref name="defaultStack"/>
                <interceptor-ref name="authnInterceptor"/>
                <interceptor-ref name="contestAccessGuard"/>
            </interceptor-stack>
            <!-- base stack -->
            <interceptor-stack name="baseStack">
                <interceptor-ref name="exception">
                    <param name="logEnabled">true</param>
                    <param name="logLevel">ERROR</param>
                </interceptor-ref>
            </interceptor-stack>
        </interceptors>

        <default-interceptor-ref name="baseStack"/>


        <global-results>
            <result name="error">/error.jsp</result>
            <result name="permissionDenied">/error.jsp</result>
            <result name="anonymous" type="redirectAction">
                <param name="actionName">home</param>
                <param name="namespace">/</param>
            </result>
        </global-results>

        <global-exception-mappings>
            <exception-mapping result="error" exception="java.lang.Exception"/>
        </global-exception-mappings>

        <action name="home" class="com.topcoder.direct.services.view.action.LandingPage">
            <interceptor-ref name="preProcessorStack"/>
            <result name="success">/WEB-INF/index.jsp</result>
            <result name="input">/WEB-INF/index.jsp</result>
        </action>
        <action name="login" class="com.topcoder.direct.services.view.action.LoginAction">
            <interceptor-ref name="preProcessorStack"/>
            <result name="success" type="redirectAction">
                <param name="actionName">dashboardActive</param>
                <param name="namespace">/</param>
            </result>
            <result name="input">/WEB-INF/index.jsp</result>
        </action>
        <action name="logout" class="com.topcoder.direct.services.view.action.LogoutAction">
            <result name="success" type="redirectAction">
                <param name="actionName">home</param>
                <param name="namespace">/</param>
            </result>
        </action>
        <action name="dashboard" class="com.topcoder.direct.services.view.action.dashboard.DashboardAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/dashboard.jsp</result>
        </action>
        <action name="dashboardLatest" class="com.topcoder.direct.services.view.action.dashboard.DashboardAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/dashboard-latest.jsp</result>
        </action>
        <action name="dashboardActive" class="com.topcoder.direct.services.view.action.dashboard.ActiveContestsAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/dashboard-active.jsp</result>
        </action>

        <action name="createProjectView" class="com.topcoder.direct.services.view.action.ForwardAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/dashboard-create-project.jsp</result>
        </action>
        <action name="createProject" class="com.topcoder.direct.services.view.action.project.CreateProjectAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success" type="redirectAction">
                <param name="actionName">createProjectView</param>
                <param name="namespace">/</param>
            </result>
        </action>
        <action name="createProjectAndContest" class="com.topcoder.direct.services.view.action.project.CreateProjectAndAddContestAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success" type="redirectAction">
                <param name="actionName">home</param>
                <param name="namespace">/launch</param>
            </result>
        </action>
        <action name="dashboardSearchView" class="com.topcoder.direct.services.view.action.dashboard.DashboardSearchAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/dashboard-search.jsp</result>
        </action>
    <action name="allProjects" class="com.topcoder.direct.services.view.action.dashboard.DashboardSearchAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/dashboard-search.jsp</result>
        </action>
        <action name="dashboardSearch" class="com.topcoder.direct.services.view.action.dashboard.DashboardSearchAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/dashboard-search.jsp</result>
            <result name="download" type="stream">
                <param name="contentDisposition">attachment;filename=searchResult.xls</param>
                <param name="contentType">application/vnd.ms-excel</param>
                <param name="inputName">viewData.inputStream</param>
                <param name="bufferSize">1024</param>
            </result>
        </action>
        <action name="contestDetails" class="com.topcoder.direct.services.view.action.contest.ContestDetailsAction">
            <interceptor-ref name="securedContestPreProcessorStack"/>
            <result name="success">/WEB-INF/contest-details.jsp</result>
        </action>
        <action name="projectDetails" class="com.topcoder.direct.services.view.action.project.ProjectContestsAction">
            <interceptor-ref name="securedProjectPreProcessorStack"/>
            <result name="success">/WEB-INF/contest-view.jsp</result>
        </action>
        <action name="currentProjectDetails" class="com.topcoder.direct.services.view.action.project.CurrentProjectContestsAction">
            <interceptor-ref name="securedProjectPreProcessorStack"/>
            <result name="success">/WEB-INF/contest-view.jsp</result>
        </action>
        <action name="permissionsView" class="com.topcoder.direct.services.view.action.ForwardAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/permissions.jsp</result>
        </action>
        <action name="currentProjectPermissionsView" class="com.topcoder.direct.services.view.action.ForwardAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/permissions.jsp</result>
        </action>
        <action name="ProjectGamePlanView" class="com.topcoder.direct.services.view.action.project.ProjectGamePlanAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/project-gameplan.jsp</result>
        </action>
        <action name="projectGamePlan" class="com.topcoder.direct.services.view.action.project.CurrentProjectGamePlanAction">
          <interceptor-ref name="securedPreProcessorStack"/>
          <result type="stream">
             <param name="contentType">text/html</param>
             <param name="inputName">inputStream</param>
           </result>
        </action>
        <action name="contestRegistrants" class="com.topcoder.direct.services.view.action.contest.ContestRegistrantsAction">
            <interceptor-ref name="securedContestStack"/>
            <result name="success">/WEB-INF/contest-registrants.jsp</result>
            <result name="download" type="stream">
                <param name="contentDisposition">attachment;filename=contest-registrants.xls</param>
                <param name="contentType">application/vnd.ms-excel</param>
                <param name="inputName">viewData.inputStream</param>
                <param name="bufferSize">1024</param>
            </result>
        </action>
        <action name="projectOverview" class="com.topcoder.direct.services.view.action.project.ProjectOverviewAction">
            <interceptor-ref name="securedProjectPreProcessorStack"/>
            <result name="success">/WEB-INF/project-overview.jsp</result>
        </action>
        <action name="currentProjectOverview"
                class="com.topcoder.direct.services.view.action.project.CurrentProjectOverviewAction">
            <interceptor-ref name="securedProjectPreProcessorStack"/>
            <result name="success">/WEB-INF/project-overview.jsp</result>
        </action>
        <action name="calendar" class="com.topcoder.direct.services.view.action.dashboard.CalendarAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/calendar.jsp</result>
        </action>

        <action name="permissionsView" class="com.topcoder.direct.services.view.action.ForwardAction">
            <interceptor-ref name="securedPreProcessorStack"/>
            <result name="success">/WEB-INF/project-permissions.jsp</result>
        </action>

        <action name="permissionsUpdateSuccess" class="permissionsUpdateSuccessAction">	
            <result name="success" type="redirectAction">
                <param name="actionName">dashboardNotifications</param>
                <param name="pn">perm</param>
            </result>
            <!--<interceptor-ref name="preProcessor"/>-->
            <!-- <result name="success">/WEB-INF/notification/dashboard-notifications.jsp?pn=perm</result>-->
        </action>

        <action name="getProjectPermissions" class="getProjectPermissionsAction">
            <interceptor-ref name="baseStack"/>
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="authnInterceptor"/>
            <result type="json" />
        </action>

        <action name="getUser" class="searchUserAction">
            <interceptor-ref name="baseStack"/>
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="authnInterceptor"/>
            <result type="json" />
        </action>

        <action name="updateProjectPermissions" class="updateProjectPermissionsAction">
            <interceptor-ref name="baseStack"/>
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="authnInterceptor"/>
            <result name="success" type="redirectAction">
                <param name="actionName">permissionsUpdateSuccess</param>
                <param name="namespace">/</param>
            </result>
        </action>

        <action name="dashboardNotifications" class="com.topcoder.direct.services.view.action.notification.DashboardNotificationsAction">
            <!--<interceptor-ref name="securedPreProcessorStack"/>-->
            <interceptor-ref name="baseStack"/>
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="authnInterceptor"/>
            <!--<interceptor-ref name="preProcessor"/>-->
            <result name="success">/WEB-INF/notification/dashboard-notifications.jsp</result>
        </action>

        <action name="updateNotifications" class="com.topcoder.direct.services.view.action.notification.UpdateNotificationsAction">
            <interceptor-ref name="authnInterceptor"/>
            <result type="json" />
        </action>

        <action name="dashboardVMAction" class="dashboardVMAction">
            <interceptor-ref name="authnInterceptor"/>
            <result name="success">/WEB-INF/vmmanager/dashboard-vm-management.jsp</result>
        </action>
        <action name="launchVMInstance" class="launchVMInstanceAction">
            <interceptor-ref name="authnInterceptor"/>
            <result type="json" />
        </action>
        <action name="terminateVMInstance" class="terminateVMInstanceAction">
            <interceptor-ref name="authnInterceptor"/>
            <result type="json" />
        </action>
        <action name="showVMInstances" class="showVMInstancesAction">
            <interceptor-ref name="authnInterceptor"/>
            <result type="json" />
        </action>
    </package>

    <package name="base" namespace="/base" extends="default">
        <interceptors>
            <interceptor-stack name="defaultDirectStack">
                <interceptor-ref name="exception">
                    <param name="logEnabled">true</param>
                    <param name="logLevel">ERROR</param>
                </interceptor-ref>
                <interceptor-ref name="alias"/>
                <interceptor-ref name="servletConfig"/>
                <interceptor-ref name="i18n"/>
                <interceptor-ref name="params">
                  <param name="acceptParamNames">contestId,projectId</param>
                  <param name="excludeParams">dojo\..*,^struts\..*,directjs.*</param>
                </interceptor-ref>
                <interceptor-ref name="prepare"/>
                <interceptor-ref name="chain"/>
                <interceptor-ref name="debugging"/>
                <interceptor-ref name="scopedModelDriven"/>
                <interceptor-ref name="modelDriven"/>
                <interceptor-ref name="fileUpload"/>
                <interceptor-ref name="checkbox"/>
                <interceptor-ref name="multiselect"/>
                <interceptor-ref name="staticParams"/>
                <interceptor-ref name="actionMappingParams"/>
                <interceptor-ref name="params">
                  <param name="excludeParams">dojo\..*,^struts\..*,directjs.*</param>
                </interceptor-ref>
                <interceptor-ref name="conversionError"/>
                <interceptor-ref name="validation">
                    <param name="excludeMethods">input,back,cancel,browse</param>
                </interceptor-ref>
                <interceptor-ref name="workflow">
                    <param name="excludeMethods">input,back,cancel,browse</param>
                </interceptor-ref>
            </interceptor-stack>

            <!-- base stack -->
            <interceptor-stack name="baseStack">
                <interceptor-ref name="defaultDirectStack"/>
                <interceptor-ref name="authnInterceptor"/>
                <interceptor-ref name="loggingInterceptor"/>
            </interceptor-stack>
        </interceptors>

        <default-interceptor-ref name="baseStack"/>
    </package>

    <package name="launch" namespace="/launch" extends="base">
        <action name="home" class="launchContestAction">
            <result>/WEB-INF/launch-contest.jsp</result>
        </action>

        <action name="createProject" class="createProjectAction">
            <result type="json" />
        </action>

        <action name="saveDraftContest" class="saveDraftContestAction">
            <result type="json" />
        </action>

        <action name="getStudioConfigs" method="getStudioConfigs" class="commonAction">
            <result type="json" />
        </action>

        <action name="documentUpload" class="documentUploadAction">
            <result type="json" />
        </action>

        <action name="removeDocument" class="removeDocumentAction">
            <result type="json" />
        </action>

        <action name="downloadDocument" class="downloadDocumentAction">
            <result type="stream">
                <param name="contentDisposition">${contentDisposition}</param>
                <param name="contentType">${document.mimeType.description}</param>
                <param name="inputName">inputStream</param>
                <param name="bufferSize">1024</param>
            </result>
        </action>

        <action name="getCategories" method="getCategories" class="commonAction">
            <result type="json" />
        </action>

        <action name="getCapacityFullDates" class="getCapacityFullDatesAction">
            <result type="json" />
        </action>

        <action name="getBillingProjectContestFees" method="getBillingProjectContestFees" class="commonAction">
            <result type="json" />
        </action>

        <action name="getDesignComponents" method="getDesignComponents" class="commonAction">
            <result type="json" />
        </action>
    </package>

    <package name="contest" namespace="/contest" extends="base">
        <action name="detail" class="getContestAction">
            <result>/WEB-INF/contest-details2.jsp</result>
        </action>

		<action name="receipt" class="getContestAction">
            <result>/WEB-INF/contest-receipt.jsp</result>
        </action>

        <action name="detailJson" class="getContestAction">
            <result type="json" />
        </action>

        <action name="repostContest" class="repostAction">
            <result name="success" type="json" />
        </action>

        <action name="newVersion" class="newVersionAction">
            <result type="json" />
        </action>

        <action name="submissions" class="contestSubmissionsAction">
            <result name="grid">/WEB-INF/studio-submissions-grid.jsp</result>
            <result name="list">/WEB-INF/studio-submissions-list.jsp</result>
            <result name="milestone" type="redirectAction">
                <param name="actionName">submissions</param>
                <param name="namespace">/contest</param>
                <param name="contestId">${contestId}</param>
                <param name="formData.viewType">GRID</param>
                <param name="formData.roundType">MILESTONE</param>
            </result>
        </action>

        <action name="studioSubmission" class="studioSubmissionAction">
            <result>/WEB-INF/studio-submissions-single.jsp</result>
        </action>
        
        <action name="updateSubmissionFeedback" class="updateStudioSubmissionFeedbackAction">
            <interceptor-ref name="baseStack"/>
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="authnInterceptor"/>
            <result type="json" />
        </action>

        <action name="checkout" class="studioSubmissionCheckoutAction">
            <result>/WEB-INF/studio-submissions-checkout.jsp</result>
        </action>
        
        <action name="saveMilestone" class="saveMilestoneAction">
            <result type="redirectAction">
                <param name="actionName">submissions</param>
                <param name="namespace">/contest</param>
                <param name="contestId">${contestId}</param>
                <param name="formData.viewType">GRID</param>
                <param name="formData.roundType">FINAL</param>
            </result>
        </action>
        
        <action name="checkoutFinal" class="checkoutFinalAction">
            <result>/WEB-INF/studio-final-checkout-confirmation.jsp</result>
        </action>

        <action name="softwareSubmissions" class="softwareContestSubmissionsAction">
            <result>/WEB-INF/software-submissions-list.jsp</result>
        </action>

        <action name="studioNoWinner" class="studioNoWinnerAction">
            <result>/WEB-INF/studio-nowinner.jsp</result>
        </action>

        <action name="studioNoWinnerDecide" class="studioNoWinnerAction">
            <result>/WEB-INF/studio-nowinner-decide.jsp</result>
        </action>

        <action name="studioNoWinnerAbandoned" class="studioAbandonContestAction">
            <result>/WEB-INF/studio-nowinner-abandoned.jsp</result>
        </action>

        <action name="updateGeneralSubmissionsFeedback" class="updateStudioGeneralFeedbackAction">
            <interceptor-ref name="baseStack"/>
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="authnInterceptor"/>
            <result type="json" />
        </action>

    </package>
</struts>
